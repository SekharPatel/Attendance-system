{% extends "base.html" %}

{% block title %}Manage Courses{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-book me-2"></i>Manage Courses</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCourseModal">
        <i class="fas fa-plus me-2"></i>Add Course
    </button>
</div>

<!-- Filter Controls -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-3">
                <label for="semester" class="form-label">Filter by Semester</label>
                <select class="form-select" id="semester" name="semester" onchange="this.form.submit()">
                    <option value="">All Semesters</option>
                    {% for stat in semester_stats %}
                    <option value="{{ stat.semester }}" {{ 'selected' if current_filters.semester==stat.semester }}>
                        Semester {{ stat.semester }} ({{ stat.count }} courses)
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="department" class="form-label">Filter by Department</label>
                <select class="form-select" id="department" name="department" onchange="this.form.submit()">
                    <option value="">All Departments</option>
                    {% for dept in departments %}
                    <option value="{{ dept }}" {{ 'selected' if current_filters.department==dept }}>{{ dept }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="search" class="form-label">Search Courses</label>
                <input type="text" class="form-control" id="search" name="search"
                    placeholder="Search by code, name, or description..." value="{{ current_filters.search or '' }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <div class="d-grid">
                    <button type="submit" class="btn btn-outline-primary">
                        <i class="fas fa-search me-1"></i>Search
                    </button>
                </div>
            </div>
        </form>
        {% if current_filters.semester or current_filters.department or current_filters.search %}
        <div class="mt-2">
            <a href="{{ url_for('admin.manage_courses') }}" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-times me-1"></i>Clear Filters
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Semester Tabs -->
<div class="card">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" id="semesterTabs" role="tablist" style="color: black;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all-courses"
                    type="button" role="tab" aria-controls="all-courses" aria-selected="true" style="color: black;">
                    All Courses ({{ courses|length }})
                </button>
            </li>
            {% for stat in semester_stats %}
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="semester-{{ stat.semester }}-tab" data-bs-toggle="tab"
                    data-bs-target="#semester-{{ stat.semester }}" type="button" role="tab"
                    aria-controls="semester-{{ stat.semester }}" aria-selected="false">
                    Semester {{ stat.semester }} ({{ stat.count }})
                </button>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="semesterTabsContent">
            <!-- All Courses Tab -->
            <div class="tab-pane fade show active" id="all-courses" role="tabpanel" aria-labelledby="all-tab">
                <div class="row g-4">
                    {% for course in courses %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 course-card" data-course-id="{{ course.id }}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-primary">{{ course.course_code }}</h6>
                                <span class="badge bg-info">Semester {{ course.semester }}</span>
                            </div>
                            <div class="card-body">
                                <h6 class="card-title">{{ course.course_name }}</h6>
                                <p class="card-text text-muted small">
                                    {{ course.description[:100] + '...' if course.description and
                                    course.description|length > 100 else course.description or 'No description
                                    available' }}
                                </p>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <small class="text-muted">Credits</small>
                                        <div class="fw-bold">{{ course.credits }}</div>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-muted">Students</small>
                                        <div class="fw-bold">
                                            {% set enrollment_count =
                                            course.enrollments.filter_by(is_active=True).count() %}
                                            {{ enrollment_count }}
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-muted">Department</small>
                                        <div class="fw-bold small">{{ course.department or 'N/A' }}</div>
                                    </div>
                                </div>
                                {% if course.teacher %}
                                <div class="mt-2">
                                    <small class="text-muted">Instructor:</small>
                                    <div class="small">{{ course.teacher.username }}</div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="card-footer bg-transparent">
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-outline-primary btn-sm"
                                        onclick="viewCourseDetails({{ course.id }})">
                                        <i class="fas fa-eye me-1"></i>View
                                    </button>
                                    <button class="btn btn-outline-warning btn-sm"
                                        onclick="editCourse({{ course.id }})">
                                        <i class="fas fa-edit me-1"></i>Edit
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm"
                                        onclick="deleteCourse({{ course.id }})">
                                        <i class="fas fa-trash me-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if not courses %}
                <div class="text-center py-5">
                    <i class="fas fa-book fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No courses found</h5>
                    <p class="text-muted">Try adjusting your filters or add a new course.</p>
                </div>
                {% endif %}
            </div>

            <!-- Individual Semester Tabs -->
            {% for semester, semester_courses in courses_by_semester.items() %}
            <div class="tab-pane fade" id="semester-{{ semester }}" role="tabpanel"
                aria-labelledby="semester-{{ semester }}-tab">
                <div class="row g-4">
                    {% for course_data in semester_courses %}
                    {% set course = course_data.course %}
                    {% set enrollment_count = course_data.enrollment_count %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 course-card" data-course-id="{{ course.id }}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-primary">{{ course.course_code }}</h6>
                                <span class="badge bg-success">{{ course.credits }} Credits</span>
                            </div>
                            <div class="card-body">
                                <h6 class="card-title">{{ course.course_name }}</h6>
                                <p class="card-text text-muted small">
                                    {{ course.description[:100] + '...' if course.description and
                                    course.description|length > 100 else course.description or 'No description
                                    available' }}
                                </p>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <small class="text-muted">Enrolled Students</small>
                                        <div class="fw-bold text-primary">{{ enrollment_count }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Department</small>
                                        <div class="fw-bold small">{{ course.department or 'N/A' }}</div>
                                    </div>
                                </div>
                                {% if course.teacher %}
                                <div class="mt-2">
                                    <small class="text-muted">Instructor:</small>
                                    <div class="small">{{ course.teacher.username }}</div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="card-footer bg-transparent">
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-outline-primary btn-sm"
                                        onclick="viewCourseDetails({{ course.id }})">
                                        <i class="fas fa-eye me-1"></i>View
                                    </button>
                                    <button class="btn btn-outline-warning btn-sm"
                                        onclick="editCourse({{ course.id }})">
                                        <i class="fas fa-edit me-1"></i>Edit
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm"
                                        onclick="deleteCourse({{ course.id }})">
                                        <i class="fas fa-trash me-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if not semester_courses %}
                <div class="text-center py-5">
                    <i class="fas fa-book fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No courses in Semester {{ semester }}</h5>
                    <p class="text-muted">Add courses to this semester to get started.</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add Course Modal -->
<div class="modal fade" id="addCourseModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="addCourseForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="course_code" class="form-label">Course Code <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="course_code" name="course_code" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="semester" class="form-label">Semester <span
                                        class="text-danger">*</span></label>
                                <select class="form-select" id="semester" name="semester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="course_name" class="form-label">Course Name <span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="course_name" name="course_name" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"
                            placeholder="Brief description of the course..."></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="credits" class="form-label">Credits</label>
                                <select class="form-select" id="credits" name="credits">
                                    <option value="1">1 Credit</option>
                                    <option value="2">2 Credits</option>
                                    <option value="3" selected>3 Credits</option>
                                    <option value="4">4 Credits</option>
                                    <option value="5">5 Credits</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="department" class="form-label">Department</label>
                                <select class="form-select" id="department" name="department">
                                    <option value="">Select Department</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Civil">Civil</option>
                                    <option value="Business">Business</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="Physics">Physics</option>
                                    <option value="Chemistry">Chemistry</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="teacher_id" class="form-label">Assign Teacher</label>
                                <select class="form-select" id="teacher_id" name="teacher_id">
                                    <option value="">Select Teacher</option>
                                    {% for teacher in teachers %}
                                    <option value="{{ teacher.id }}">{{ teacher.username }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>Add Course
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Course Modal -->
<div class="modal fade" id="editCourseModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editCourseForm">
                <input type="hidden" id="edit_course_id" name="course_id">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_course_code" class="form-label">Course Code <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="edit_course_code" name="course_code"
                                    required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_semester" class="form-label">Semester <span
                                        class="text-danger">*</span></label>
                                <select class="form-select" id="edit_semester" name="semester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit_course_name" class="form-label">Course Name <span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="edit_course_name" name="course_name" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit_description" class="form-label">Description</label>
                        <textarea class="form-control" id="edit_description" name="description" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="edit_credits" class="form-label">Credits</label>
                                <select class="form-select" id="edit_credits" name="credits">
                                    <option value="1">1 Credit</option>
                                    <option value="2">2 Credits</option>
                                    <option value="3">3 Credits</option>
                                    <option value="4">4 Credits</option>
                                    <option value="5">5 Credits</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="edit_department" class="form-label">Department</label>
                                <select class="form-select" id="edit_department" name="department">
                                    <option value="">Select Department</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Mechanical">Mechanical</option>
                                    <option value="Civil">Civil</option>
                                    <option value="Business">Business</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="Physics">Physics</option>
                                    <option value="Chemistry">Chemistry</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="edit_teacher_id" class="form-label">Assign Teacher</label>
                                <select class="form-select" id="edit_teacher_id" name="teacher_id">
                                    <option value="">Select Teacher</option>
                                    {% for teacher in teachers %}
                                    <option value="{{ teacher.id }}">{{ teacher.username }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save me-1"></i>Update Course
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Course Details Modal -->
<div class="modal fade" id="courseDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Course Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="courseDetailsContent">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .course-card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .course-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .nav-tabs .nav-link {
        color: #6c757d;
        border: none;
        border-bottom: 2px solid transparent;
    }

    .nav-tabs .nav-link.active {
        color: #0d6efd;
        border-bottom-color: #0d6efd;
        background-color: transparent;
    }

    .nav-tabs .nav-link:hover {
        border-bottom-color: #0d6efd;
        color: #0d6efd;
    }

    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }

    .badge {
        font-size: 0.75em;
    }

    .btn-group .btn {
        flex: 1;
    }

    .text-muted {
        color: #6c757d !important;
    }

    .fw-bold {
        font-weight: 600 !important;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    // Add Course Form Handler
    document.getElementById('addCourseForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);

        // Convert empty strings to null for optional fields
        if (!data.teacher_id) data.teacher_id = null;
        if (!data.department) data.department = null;
        if (!data.description) data.description = null;

        try {
            const response = await fetch('/api/courses', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                showAlert('Course added successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('addCourseModal')).hide();
                setTimeout(() => location.reload(), 1000);
            } else {
                showAlert('Error: ' + result.error, 'danger');
            }
        } catch (error) {
            showAlert('Error adding course: ' + error.message, 'danger');
        }
    });

    // Edit Course Form Handler
    document.getElementById('editCourseForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        const courseId = data.course_id;
        delete data.course_id;

        // Convert empty strings to null for optional fields
        if (!data.teacher_id) data.teacher_id = null;
        if (!data.department) data.department = null;
        if (!data.description) data.description = null;

        try {
            const response = await fetch(`/api/courses/${courseId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                showAlert('Course updated successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('editCourseModal')).hide();
                setTimeout(() => location.reload(), 1000);
            } else {
                showAlert('Error: ' + result.error, 'danger');
            }
        } catch (error) {
            showAlert('Error updating course: ' + error.message, 'danger');
        }
    });

    async function viewCourseDetails(courseId) {
        try {
            const response = await fetch(`/api/courses/${courseId}`);
            const course = await response.json();

            if (response.ok) {
                const content = `
                <div class="row">
                    <div class="col-md-8">
                        <h4>${course.course_code} - ${course.course_name}</h4>
                        <p class="text-muted">${course.description || 'No description available'}</p>
                        
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <strong>Semester:</strong><br>
                                <span class="badge bg-info fs-6">Semester ${course.semester}</span>
                            </div>
                            <div class="col-md-3">
                                <strong>Credits:</strong><br>
                                ${course.credits}
                            </div>
                            <div class="col-md-3">
                                <strong>Department:</strong><br>
                                ${course.department || 'N/A'}
                            </div>
                            <div class="col-md-3">
                                <strong>Instructor:</strong><br>
                                ${course.teacher || 'Unassigned'}
                            </div>
                        </div>
                        
                        <h5>Enrolled Students (${course.enrollment_count})</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Student ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Department</th>
                                        <th>Semester</th>
                                        <th>Enrolled Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${course.enrolled_students.map(student => `
                                        <tr>
                                            <td>${student.student_id}</td>
                                            <td>${student.full_name}</td>
                                            <td>${student.email}</td>
                                            <td>${student.department || 'N/A'}</td>
                                            <td>Semester ${student.semester}</td>
                                            <td>${new Date(student.enrollment_date).toLocaleDateString()}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ${course.enrolled_students.length === 0 ? '<p class="text-muted">No students enrolled in this course.</p>' : ''}
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Course Statistics</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <small class="text-muted">Total Enrollments</small>
                                    <div class="h4 text-primary">${course.enrollment_count}</div>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">Created Date</small>
                                    <div>${new Date(course.created_at).toLocaleDateString()}</div>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">Status</small>
                                    <div>
                                        <span class="badge bg-${course.is_active ? 'success' : 'secondary'}">
                                            ${course.is_active ? 'Active' : 'Inactive'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

                document.getElementById('courseDetailsContent').innerHTML = content;
                new bootstrap.Modal(document.getElementById('courseDetailsModal')).show();
            } else {
                showAlert('Error loading course details: ' + course.error, 'danger');
            }
        } catch (error) {
            showAlert('Error loading course details: ' + error.message, 'danger');
        }
    }

    async function editCourse(courseId) {
        try {
            const response = await fetch(`/api/courses/${courseId}`);
            const course = await response.json();

            if (response.ok) {
                // Populate edit form
                document.getElementById('edit_course_id').value = course.id;
                document.getElementById('edit_course_code').value = course.course_code;
                document.getElementById('edit_course_name').value = course.course_name;
                document.getElementById('edit_description').value = course.description || '';
                document.getElementById('edit_credits').value = course.credits;
                document.getElementById('edit_semester').value = course.semester;
                document.getElementById('edit_department').value = course.department || '';
                document.getElementById('edit_teacher_id').value = course.teacher_id || '';

                new bootstrap.Modal(document.getElementById('editCourseModal')).show();
            } else {
                showAlert('Error loading course data: ' + course.error, 'danger');
            }
        } catch (error) {
            showAlert('Error loading course data: ' + error.message, 'danger');
        }
    }

    async function deleteCourse(courseId) {
        if (confirm('Are you sure you want to delete this course? This action cannot be undone.')) {
            try {
                const response = await fetch(`/api/courses/${courseId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('Course deleted successfully!', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showAlert('Error: ' + result.error, 'danger');
                }
            } catch (error) {
                showAlert('Error deleting course: ' + error.message, 'danger');
            }
        }
    }

    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
        document.body.appendChild(alertDiv);

        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.parentNode.removeChild(alertDiv);
            }
        }, 5000);
    }

    // Initialize tooltips if needed
    document.addEventListener('DOMContentLoaded', function () {
        // Auto-focus on search input when page loads
        const searchInput = document.getElementById('search');
        if (searchInput && searchInput.value) {
            searchInput.focus();
        }
    });
</script>
{% endblock %}""